<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Finanças</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --cor-fundo: #161a2b;
            --cor-card-fundo: rgba(31, 35, 61, 0.75); 
            --cor-card-fundo-solido: #1f233d;
            --cor-fundo-item: #2a2f4c;
            --cor-primary: #8A2BE2; 
            --cor-primary-gradient: linear-gradient(45deg, #8A2BE2, #4c6fff);
            --cor-essencial: #00aaff; 
            --cor-opcional: #f0c419;  
            --cor-investimento: #00e676; 
            --cor-perigo: #ff4757;
            --cor-texto-principal: #ffffff;
            --cor-texto-secundario: #a0a0c0;
            --cor-borda-cinza: #404060;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body { 
            font-family: 'Inter', 'Segoe UI', Arial, sans-serif; 
            padding: 20px;
            background-color: var(--cor-fundo); 
            color: var(--cor-texto-principal);
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Alterado de center para flex-start para permitir scroll */
            align-items: center;
            min-height: 100vh;
            position: relative;
            
            /* [CORREÇÃO DO SCROLL] */
            overflow-x: hidden; /* Esconde apenas a rolagem lateral */
            overflow-y: auto;   /* Permite a rolagem vertical */
        }
        
        /* [MELHORIA VISUAL] Fundo fixo ao rolar */
        body::before {
            content: '';
            position: fixed; /* Mudado de absolute para fixed */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(76, 111, 255, 0.2), transparent 60%);
            filter: blur(150px);
            z-index: -1;
            opacity: 0.7;
            pointer-events: none; /* Garante que o fundo não atrapalhe cliques */
        }

        .main-header {
            width: 100%;
            max-width: 750px; 
            text-align: center;
            margin-bottom: 25px;
            margin-top: 20px; /* Espaço extra no topo */
        }
        
        .main-header h1 {
            font-size: 2.8em; 
            color: var(--cor-texto-principal);
            margin: 0;
            font-weight: 700; 
        }
        
        .container h2 { 
            text-align: center; 
            color: var(--cor-texto-secundario); 
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 1.5em;
        }
        .container h3 {
            color: var(--cor-texto-secundario);
            margin-bottom: 15px;
            font-weight: 600;
            text-align: left;
            font-size: 1.2em;
        }

        .container { 
            max-width: 750px; 
            width: 100%;
            background: var(--cor-card-fundo); 
            padding: 40px; 
            border-radius: 24px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px); 
            margin-bottom: 40px; /* Espaço no final da página para o scroll não cortar */
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-header h2 {
            margin: 0;
            text-align: left;
        }

        #btn-resetar {
            padding: 8px 14px;
            background: transparent;
            color: var(--cor-perigo);
            border: 2px solid var(--cor-perigo);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        #btn-resetar:hover {
            background: var(--cor-perigo);
            color: var(--cor-texto-principal);
            transform: translateY(-2px);
        }
        
        .renda-container { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 40px; 
            align-items: center;
        }
        .renda-container input { 
            flex: 1; 
            padding: 12px 5px;
            border: none;
            border-bottom: 2px solid var(--cor-borda-cinza);
            background: transparent;
            color: var(--cor-texto-principal);
            font-size: 1.1em;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.3s ease;
        }
        .renda-container input:focus {
            outline: none;
            border-color: var(--cor-primary);
        }
        
        .renda-container button { 
            padding: 12px 22px; 
            background: var(--cor-investimento);
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 230, 118, 0.2);
        }
        .renda-container button:hover {
             transform: translateY(-2px);
             box-shadow: 0 6px 20px rgba(0, 230, 118, 0.3);
        }
        
        .orcamento-visual {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 220px; 
            margin-bottom: 40px;
            padding: 0 20px;
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .balanco-circle {
            position: relative;
            width: 190px;
            height: 190px;
            border-radius: 50%;
            padding: 10px; 
            background: conic-gradient(var(--cor-borda-cinza) 0% 100%); 
            z-index: 10;
            cursor: pointer;
            transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .balanco-circle-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: var(--cor-card-fundo-solido);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        .balanco-circle h2 { font-size: 1em; margin-bottom: 5px; color: var(--cor-texto-secundario); }
        .balanco-circle #balanco-valor { font-size: 1.8em; font-weight: 700; }
        #balanco-valor.positivo { color: var(--cor-investimento); }
        #balanco-valor.negativo { color: var(--cor-perigo); }

        .categorias-container {
            position: absolute;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 5;
            transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .categoria-circle {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.2); 
            box-shadow: inset 0 0 8px rgba(0,0,0,0.4);
            overflow: hidden; 
            border: 2px solid var(--cor-borda-cinza); 
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.5s ease;
            text-align: center;
        }
        .categoria-circle:hover {
            transform: scale(1.05);
            border-color: var(--cor-texto-secundario);
        }
        .categoria-circle::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px; 
            border-radius: 50%;
            border: 3px solid transparent;
            z-index: 1;
            background: conic-gradient(transparent 0% 0%, var(--cor-borda-progresso) 0% 0%);
        }
        
        .categoria-circle h4 { 
            margin: 5px 0 0 0;
            font-size: 0.95em;
            color: var(--cor-texto-principal);
            font-weight: 400;
            z-index: 2; 
        }
        .categoria-circle .gasto { 
            font-weight: 700; 
            font-size: 1.4em; 
            margin: 4px 0; 
            z-index: 2; 
        }
        .categoria-circle .meta { 
            font-size: 0.85em; 
            color: var(--cor-texto-secundario); 
            z-index: 2; 
            margin: 0 0 5px 0; 
        }
        
        .categoria-circle.essencial .gasto { color: var(--cor-essencial); }
        .categoria-circle.opcional .gasto { color: var(--cor-opcional); }
        .categoria-circle.investimento .gasto { color: var(--cor-investimento); }

        /* ESTADO ATIVO */
        .orcamento-visual.ativo .balanco-circle {
            transform: translateX(-205px); 
        }
        .orcamento-visual.ativo .categorias-container {
            transform: translateX(115px);
        }
        .orcamento-visual.ativo .categoria-circle { opacity: 1; transform: scale(1); }
        .orcamento-visual.ativo .categoria-circle:nth-child(1) { transition-delay: 0.1s; }
        .orcamento-visual.ativo .categoria-circle:nth-child(2) { transition-delay: 0.2s; }
        .orcamento-visual.ativo .categoria-circle:nth-child(3) { transition-delay: 0.3s; }
        
        /* Formulário */
        form { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin-bottom: 40px; 
            background: rgba(0,0,0,0.15);
            padding: 25px;
            border-radius: 16px;
        }
        form label { 
            grid-column: 1 / -1; 
            margin-bottom: -10px; 
            color: var(--cor-texto-secundario);
            font-size: 0.9em;
            font-weight: 600;
        }
        form input, form select { 
            width: 100%; 
            padding: 12px 5px;
            border: none;
            border-bottom: 2px solid var(--cor-borda-cinza);
            background: transparent;
            color: var(--cor-texto-principal);
            font-size: 1.1em;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.3s ease;
        }
        form input:focus, form select:focus {
            outline: none;
            border-color: var(--cor-primary);
        }
        form select {
            grid-column: 1 / -1;
        }
        
        .form-botoes {
            grid-column: 1 / -1;
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .form-botoes button {
            flex: 1;
            font-size: 1.1em;
            padding: 14px; 
            cursor: pointer;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        #btn-submit {
            background: var(--cor-primary-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.2);
        }
        #btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(138, 43, 226, 0.4);
        }
        #btn-cancel-edit {
            background-color: var(--cor-borda-cinza);
            color: var(--cor-texto-secundario);
            display: none; 
        }
        #btn-cancel-edit:hover {
            background-color: #505070;
            color: var(--cor-texto-principal);
        }
        
        form.edit-mode #btn-submit {
            background: linear-gradient(45deg, var(--cor-opcional), #ffd700);
            color: #333; 
            box-shadow: 0 4px 15px rgba(240, 196, 25, 0.3);
        }
        form.edit-mode #btn-submit:hover {
            box-shadow: 0 6px 20px rgba(240, 196, 25, 0.4);
        }
        form.edit-mode #btn-cancel-edit {
            display: block;
        }

        
        ul { list-style-type: none; padding: 0; }
        li { 
            background: var(--cor-fundo-item); 
            padding: 15px 20px; 
            margin-bottom: 10px; 
            border-radius: 10px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            border: 1px solid transparent;
            border-left: 5px solid; 
            transition: all 0.3s ease;
        }
        li:hover {
            transform: translateX(5px);
            background: var(--cor-card-fundo-solido);
            border-color: var(--cor-borda-cinza);
        }
        
        li .transacao-info { flex: 1; }
        li .transacao-info span { display: block; }
        li .transacao-info span:first-child {
            color: var(--cor-texto-principal);
            font-weight: 600;
            font-size: 1.05em;
            margin-bottom: 4px;
        }
        li .transacao-info .transacao-valor { 
            font-weight: 600; 
            font-size: 1.1em; 
        }
        
        li.essencial { border-left-color: var(--cor-essencial); }
        li.essencial .transacao-valor { color: var(--cor-essencial); }
        
        li.opcional { border-left-color: var(--cor-opcional); }
        li.opcional .transacao-valor { color: var(--cor-opcional); }
        
        li.investimento { border-left-color: var(--cor-investimento); }
        li.investimento .transacao-valor { color: var(--cor-investimento); }

        .transacao-acoes {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-edit, .btn-delete {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .btn-edit svg {
            width: 18px; height: 18px;
            stroke: var(--cor-opcional);
            stroke-width: 2;
        }
        .btn-edit:hover {
            background-color: rgba(240, 196, 25, 0.1);
            transform: scale(1.1);
        }
        
        .btn-delete svg {
            width: 18px; height: 18px;
            stroke: var(--cor-perigo);
            stroke-width: 2;
        }
        .btn-delete:hover {
            background-color: rgba(255, 71, 87, 0.1);
            transform: scale(1.1);
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            body { padding: 15px; }
            .container { padding: 25px; }
            .main-header h1 { font-size: 2.2em; }
            
            .orcamento-visual.ativo {
                flex-direction: column;
                min-height: 400px;
                gap: 20px;
            }
            .orcamento-visual.ativo .balanco-circle { transform: translateX(0); }
            .orcamento-visual.ativo .categorias-container {
                position: relative; 
                transform: translateX(0);
                justify-content: center;
                flex-wrap: wrap;
                width: 100%;
            }
            form { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <header class="main-header">
        <h1>Gerenciador de Finanças</h1>
    </header>

    <main class="container">
        
        <h2>Defina sua Renda Mensal</h2>
        <div class="renda-container">
            <input type="number" id="renda-mensal" placeholder="Digite sua renda total (ex: 3000)">
            <button id="btn-definir-renda">Definir</button>
        </div>

        <div class="section-header">
            <h2>Meu Orçamento</h2>
            <button id="btn-resetar">Resetar Mês</button>
        </div>
        
        <div class="orcamento-visual" id="orcamento-visual">
            
            <div class="balanco-circle" id="balanco-circle">
                <div class="balanco-circle-inner">
                    <h2>Saldo Restante</h2>
                    <span id="balanco-valor" class="positivo">R$ 0.00</span>
                </div>
            </div>

            <div class="categorias-container">
                <div class="categoria-circle essencial" id="circle-essencial">
                    <h4>Essenciais (50%)</h4>
                    <p class="gasto" id="gasto-essencial">R$ 0.00</p>
                    <p class="meta"><span id="meta-essencial">Meta: R$ 0.00</span></p>
                </div>
                <div class="categoria-circle opcional" id="circle-opcional">
                    <h4>Opcionais (30%)</h4>
                    <p class="gasto" id="gasto-opcional">R$ 0.00</p>
                    <p class="meta"><span id="meta-opcional">Meta: R$ 0.00</span></p>
                </div>
                <div class="categoria-circle investimento" id="circle-investimento">
                    <h4>Investimentos (20%)</h4>
                    <p class="gasto" id="gasto-investimento">R$ 0.00</p>
                    <p class="meta"><span id="meta-investimento">Meta: R$ 0.00</span></p>
                </div>
            </div>
        </div>

        <form id="form-transacao">
            <h3>Adicionar Despesa</h3>
            <input type="hidden" id="edit-id" value="">
            
            <label for="descricao">Descrição da Despesa</label>
            <input type="text" id="descricao" placeholder="Ex: Aluguel, Cinema, Ações" required>
            
            <label for="valor">Valor da Despesa</label>
            <input type="number" id="valor" placeholder="Ex: 50.00" min="0" step="0.01" required>

            <label for="categoria">Categoria</label>
            <select id="categoria" required>
                <option value="">Selecione a categoria</option>
                <option value="essencial">Essencial (Moradia, Contas, Mercado)</option>
                <option value="opcional">Opcional (Lazer, Compras, Restaurante)</option>
                <option value="investimento">Investimento/Poupança (Ações, Fundo, Dívidas)</option>
            </select>
            
            <div class="form-botoes">
                <button type="submit" id="btn-submit">Adicionar Despesa</button>
                <button type="button" id="btn-cancel-edit">Cancelar</button>
            </div>
        </form>

        <h2>Histórico de Despesas</h2>
        <ul id="lista-transacoes">
        </ul>
    </main>

    <script>
document.addEventListener('DOMContentLoaded', () => {

    // --- Seletores de Elementos ---
    const rendaInput = document.getElementById('renda-mensal');
    const btnDefinirRenda = document.getElementById('btn-definir-renda');
    const btnResetar = document.getElementById('btn-resetar');
    
    const orcamentoVisual = document.getElementById('orcamento-visual');
    const balancoCircle = document.getElementById('balanco-circle');
    const balancoValor = document.getElementById('balanco-valor');
    
    const metaEssencialEl = document.getElementById('meta-essencial');
    const metaOpcionalEl = document.getElementById('meta-opcional');
    const metaInvestimentoEl = document.getElementById('meta-investimento');
    
    const gastoEssencialEl = document.getElementById('gasto-essencial');
    const gastoOpcionalEl = document.getElementById('gasto-opcional');
    const gastoInvestimentoEl = document.getElementById('gasto-investimento');

    const circleEssencial = document.getElementById('circle-essencial');
    const circleOpcional = document.getElementById('circle-opcional');
    const circleInvestimento = document.getElementById('circle-investimento');

    const form = document.getElementById('form-transacao');
    const editIdInput = document.getElementById('edit-id');
    const descricaoInput = document.getElementById('descricao');
    const valorInput = document.getElementById('valor');
    const categoriaSelect = document.getElementById('categoria');
    const listaTransacoes = document.getElementById('lista-transacoes');
    const btnSubmit = document.getElementById('btn-submit');
    const btnCancelEdit = document.getElementById('btn-cancel-edit');

    const STORAGE_KEY = 'financasAppDados';

    let rendaTotal = 0.00;
    let gastoTotal = 0.00;
    let gastosPorCategoria = {
        essencial: 0.00,
        opcional: 0.00,
        investimento: 0.00
    };
    let transacoes = []; 

    // --- Funções Principais ---

    function saveData() {
        const dados = {
            rendaTotal,
            gastoTotal,
            gastosPorCategoria,
            transacoes
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(dados));
    }

    function loadData() {
        const dadosSalvos = localStorage.getItem(STORAGE_KEY);
        if (dadosSalvos) {
            const dados = JSON.parse(dadosSalvos);
            rendaTotal = dados.rendaTotal || 0.00;
            gastoTotal = dados.gastoTotal || 0.00;
            gastosPorCategoria = dados.gastosPorCategoria || { essencial: 0, opcional: 0, investimento: 0 };
            transacoes = dados.transacoes || [];
            
            if (rendaTotal > 0) {
              rendaInput.value = rendaTotal;
            }
            transacoes.sort((a, b) => b.id - a.id).forEach(adicionarDespesaDOM);
        }
    }

    function init() {
        loadData();
        atualizarTudo();
        animarBordasPequenas();
    }

    function definirRenda() {
        const renda = parseFloat(rendaInput.value);
        if (isNaN(renda) || renda <= 0) {
            alert('Por favor, insira um valor de renda válido.');
            return;
        }
        
        rendaTotal = renda;
        
        if (transacoes.length > 0) {
            if (confirm("Você definiu uma nova renda. Deseja limpar as transações do mês anterior?")) {
                resetarMes(false); 
            }
        }
        
        atualizarTudo();
    }

    function handleFormSubmit(e) {
        e.preventDefault(); 
        const idEdicao = editIdInput.value;

        if (idEdicao) {
            salvarEdicao(parseInt(idEdicao));
        } else {
            adicionarDespesa();
        }
    }

    function adicionarDespesa() {
        const descricao = descricaoInput.value;
        const valor = parseFloat(valorInput.value);
        const categoria = categoriaSelect.value;

        if (descricao.trim() === '' || isNaN(valor) || valor <= 0 || categoria === '') {
            alert('Por favor, preencha todos os campos corretamente.'); return;
        }
        if (rendaTotal <= 0) {
            alert('Por favor, defina sua renda mensal primeiro.'); return;
        }

        const despesa = {
            id: Date.now(), 
            descricao: descricao,
            valor: valor,
            categoria: categoria
        };

        transacoes.unshift(despesa); 
        gastoTotal += valor;
        gastosPorCategoria[categoria] += valor;

        adicionarDespesaDOM(despesa); 
        atualizarTudo();
        limparFormulario();
    }
    
    function iniciarEdicao(id) {
        const transacao = transacoes.find(t => t.id === id);
        if (!transacao) return;

        form.classList.add('edit-mode');
        editIdInput.value = transacao.id;
        descricaoInput.value = transacao.descricao;
        valorInput.value = transacao.valor;
        categoriaSelect.value = transacao.categoria;
        btnSubmit.textContent = 'Salvar Edição';
        
        form.scrollIntoView({ behavior: 'smooth' }); 
        descricaoInput.focus();
    }
    
    function salvarEdicao(id) {
        const transacao = transacoes.find(t => t.id === id);
        if (!transacao) return;

        const valorAntigo = transacao.valor;
        const categoriaAntiga = transacao.categoria;

        const novoValor = parseFloat(valorInput.value);
        const novaCategoria = categoriaSelect.value;
        const novaDescricao = descricaoInput.value;

        if (novaDescricao.trim() === '' || isNaN(novoValor) || novoValor <= 0 || novaCategoria === '') {
            alert('Por favor, preencha todos os campos corretamente.'); return;
        }

        gastoTotal = (gastoTotal - valorAntigo) + novoValor;
        gastosPorCategoria[categoriaAntiga] -= valorAntigo;
        gastosPorCategoria[novaCategoria] += novoValor;

        transacao.valor = novoValor;
        transacao.categoria = novaCategoria;
        transacao.descricao = novaDescricao;

        const itemLi = document.querySelector(`.btn-edit[data-id="${id}"]`).closest('li');
        itemLi.className = ''; 
        itemLi.classList.add(novaCategoria);
        itemLi.querySelector('.transacao-info span:first-child').textContent = novaDescricao;
        itemLi.querySelector('.transacao-info .transacao-valor').textContent = `- R$ ${novoValor.toFixed(2)}`;

        cancelarEdicao();
        atualizarTudo();
    }
    
    function cancelarEdicao() {
        form.classList.remove('edit-mode');
        editIdInput.value = '';
        btnSubmit.textContent = 'Adicionar Despesa';
        limparFormulario();
    }

    function limparFormulario() {
        descricaoInput.value = '';
        valorInput.value = '';
        categoriaSelect.value = '';
    }

    function excluirTransacao(id) {
        const transacao = transacoes.find(t => t.id === id);
        if (!transacao) return;

        gastoTotal -= transacao.valor;
        gastosPorCategoria[transacao.categoria] -= transacao.valor;
        transacoes = transacoes.filter(t => t.id !== id);
        const elementoLI = document.querySelector(`.btn-delete[data-id="${id}"]`).closest('li');
        if (elementoLI) elementoLI.remove();

        atualizarTudo();
    }

    function resetarMes(confirmar = true) {
        if (confirmar) {
            if (!confirm('Você tem certeza que deseja resetar o mês? Todas as suas despesas serão apagadas.')) {
                return;
            }
        }
        gastoTotal = 0.00;
        gastosPorCategoria = { essencial: 0.00, opcional: 0.00, investimento: 0.00 };
        transacoes = [];
        listaTransacoes.innerHTML = ''; 
        atualizarTudo();
        cancelarEdicao(); 
    }
    
    function adicionarDespesaDOM(despesa) {
        const item = document.createElement('li');
        item.classList.add(despesa.categoria); 

        item.innerHTML = `
            <div class="transacao-info">
                <span>${despesa.descricao}</span>
                <span class="transacao-valor">- R$ ${despesa.valor.toFixed(2)}</span>
            </div>
            <div class="transacao-acoes">
                <button class="btn-edit" data-id="${despesa.id}" title="Editar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4L18.5 2.5z"></path></svg>
                </button>
                <button class="btn-delete" data-id="${despesa.id}" title="Excluir">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                </button>
            </div>
        `;
        listaTransacoes.prepend(item);
    }
    
    function atualizarTudo() {
        atualizarMetasTexto();
        atualizarBalancoGeral();
        atualizarGastosCategoria();
        atualizarBordaBalanco();
        saveData(); 
    }
    
    function atualizarMetasTexto() {
        metaEssencialEl.textContent = `Meta: R$ ${(rendaTotal * 0.50).toFixed(2)}`;
        metaOpcionalEl.textContent = `Meta: R$ ${(rendaTotal * 0.30).toFixed(2)}`;
        metaInvestimentoEl.textContent = `Meta: R$ ${(rendaTotal * 0.20).toFixed(2)}`;
    }

    function atualizarBalancoGeral() {
        const saldoRestante = rendaTotal - gastoTotal;
        balancoValor.textContent = `R$ ${saldoRestante.toFixed(2)}`;
        balancoValor.className = saldoRestante >= 0 ? 'positivo' : 'negativo';
    }

    function atualizarGastosCategoria() {
        gastoEssencialEl.textContent = `R$ ${gastosPorCategoria.essencial.toFixed(2)}`;
        gastoOpcionalEl.textContent = `R$ ${gastosPorCategoria.opcional.toFixed(2)}`;
        gastoInvestimentoEl.textContent = `R$ ${gastosPorCategoria.investimento.toFixed(2)}`;
        
        if (rendaTotal > 0) {
            const metaEssencial = rendaTotal * 0.50;
            const percentEssencial = metaEssencial > 0 ? (gastosPorCategoria.essencial / metaEssencial) * 100 : 0;
            updateCircleProgress(circleEssencial, percentEssencial, 'var(--cor-essencial)');

            const metaOpcional = rendaTotal * 0.30;
            const percentOpcional = metaOpcional > 0 ? (gastosPorCategoria.opcional / metaOpcional) * 100 : 0;
            updateCircleProgress(circleOpcional, percentOpcional, 'var(--cor-opcional)');

            const metaInvestimento = rendaTotal * 0.20;
            const percentInvestimento = metaInvestimento > 0 ? (gastosPorCategoria.investimento / metaInvestimento) * 100 : 0;
            updateCircleProgress(circleInvestimento, percentInvestimento, 'var(--cor-investimento)');
        } else {
            updateCircleProgress(circleEssencial, 0, 'var(--cor-essencial)');
            updateCircleProgress(circleOpcional, 0, 'var(--cor-opcional)');
            updateCircleProgress(circleInvestimento, 0, 'var(--cor-investimento)');
        }
    }
    
    function updateCircleProgress(element, percentage, color) {
        const progress = Math.min(100, Math.max(0, percentage));
        const fillDegree = (progress / 100) * 360; 
        element.style.setProperty('--fill-percentage', `${fillDegree}deg`);
        element.style.setProperty('--cor-borda-progresso', color);
    }
    
    function animarBordasPequenas() {
        const circles = [circleEssencial, circleOpcional, circleInvestimento];
        circles.forEach(circle => {
            circle.style.animation = 'none';
            circle.offsetHeight; 
            circle.style.animation = `fillCircle 0.5s ease-out forwards`;
        });
    }

    function atualizarBordaBalanco() {
        if (gastoTotal === 0) {
            balancoCircle.style.background = 'var(--cor-borda-cinza)';
            return;
        }
        const pEssencial = (gastosPorCategoria.essencial / gastoTotal) * 360;
        const pOpcional = (gastosPorCategoria.opcional / gastoTotal) * 360;
        const grauEssencial = pEssencial;
        const grauOpcional = pEssencial + pOpcional;

        const gradiente = `conic-gradient(
            var(--cor-essencial) 0deg ${grauEssencial}deg,
            var(--cor-opcional) ${grauEssencial}deg ${grauOpcional}deg,
            var(--cor-investimento) ${grauOpcional}deg 360deg
        )`;
        
        balancoCircle.style.background = gradiente;
    }

    function toggleDashboard() {
        orcamentoVisual.classList.toggle('ativo');
    }

    function handleListClick(e) {
        const deleteButton = e.target.closest('.btn-delete');
        if (deleteButton) {
            const id = parseInt(deleteButton.dataset.id);
            excluirTransacao(id);
            return; 
        }

        const editButton = e.target.closest('.btn-edit');
        if (editButton) {
            const id = parseInt(editButton.dataset.id);
            iniciarEdicao(id);
        }
    }

    // --- Event Listeners ---
    btnDefinirRenda.addEventListener('click', definirRenda);
    btnResetar.addEventListener('click', resetarMes);
    balancoCircle.addEventListener('click', toggleDashboard);
    btnCancelEdit.addEventListener('click', cancelarEdicao);
    form.addEventListener('submit', handleFormSubmit);
    listaTransacoes.addEventListener('click', handleListClick);
    
    // --- Inicialização ---
    init(); 
    
    const styleSheet = document.createElement("style");
    styleSheet.type = "text/css";
    styleSheet.innerText = `
        @keyframes fillCircle {
            from { background: conic-gradient(transparent var(--fill-percentage, 0deg) 360deg, var(--cor-borda-progresso) 0deg var(--fill-percentage, 0deg)); }
            to { background: conic-gradient(transparent 0deg var(--fill-percentage, 0deg), var(--cor-borda-progresso) var(--fill-percentage, 0deg) 360deg); }
        }
    `;
    document.head.appendChild(styleSheet);

});
    </script>
</body>
</html>
